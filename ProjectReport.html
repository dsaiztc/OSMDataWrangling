<!doctype html>
<html lang='en'>
<head>
<meta charset='utf-8'>
<title>Project Report - OSM Data Wrangling with MongoDB</title><link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css'><style type='text/css'>html, body {overflow-x: initial !important;}.CodeMirror { height: auto; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; }
.CodeMirror-lines { padding: 4px 0px; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler { background-color: white; }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247); white-space: nowrap; }
.CodeMirror-linenumbers { }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; min-width: 20px; text-align: right; color: rgb(153, 153, 153); }
.CodeMirror div.CodeMirror-cursor { border-left-width: 1px; border-left-style: solid; border-left-color: black; z-index: 3; }
.CodeMirror div.CodeMirror-secondarycursor { border-left-width: 1px; border-left-style: solid; border-left-color: silver; }
.CodeMirror.cm-keymap-fat-cursor div.CodeMirror-cursor { width: auto; border: 0px; background-color: rgb(119, 238, 119); z-index: 1; background-position: initial initial; background-repeat: initial initial; }
.CodeMirror div.CodeMirror-cursor.CodeMirror-overwrite { }
.cm-tab { display: inline-block; }
.cm-s-default .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-default .cm-atom { color: rgb(34, 17, 153); }
.cm-s-default .cm-number { color: rgb(17, 102, 68); }
.cm-s-default .cm-def { color: rgb(0, 0, 255); }
.cm-s-default .cm-variable { color: black; }
.cm-s-default .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-default .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-default .cm-property { color: black; }
.cm-s-default .cm-operator { color: black; }
.cm-s-default .cm-comment { color: rgb(170, 85, 0); }
.cm-s-default .cm-string { color: rgb(170, 17, 17); }
.cm-s-default .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-default .cm-meta { color: rgb(85, 85, 85); }
.cm-s-default .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-default .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-default .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-default .cm-tag { color: rgb(17, 119, 0); }
.cm-s-default .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-default .cm-header { color: blue; }
.cm-s-default .cm-quote { color: rgb(0, 153, 0); }
.cm-s-default .cm-hr { color: rgb(153, 153, 153); }
.cm-s-default .cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: bold; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-s-default .cm-error { color: rgb(255, 0, 0); }
.cm-invalidchar { color: rgb(255, 0, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.CodeMirror-activeline-background { background-color: rgb(232, 242, 255); background-position: initial initial; background-repeat: initial initial; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { margin-bottom: -30px; margin-right: -30px; padding-bottom: 30px; padding-right: 30px; height: 100%; outline: none; position: relative; box-sizing: content-box; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow-x: hidden; overflow-y: scroll; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow-y: hidden; overflow-x: scroll; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; border-width: 0px; background-color: transparent; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; background-position: initial initial; background-repeat: initial initial; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: -webkit-fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-style: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-widget { }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-style: none; width: 0px; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: visible; }
.CodeMirror-selected { background-color: rgb(217, 217, 217); background-position: initial initial; background-repeat: initial initial; }
.CodeMirror-focused .CodeMirror-selected { background-color: rgb(215, 212, 240); background-position: initial initial; background-repeat: initial initial; }
.cm-searching { background-color: rgba(255, 255, 0, 0.4); background-position: initial initial; background-repeat: initial initial; }
.CodeMirror span { }
@media print { 
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


html { font-size: 14px; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 1rem; line-height: 1.42857143; color: rgb(51, 51, 51); background-color: rgb(255, 255, 255); overflow-x: hidden; }
a:active, a:hover { outline: 0px; }
::selection { background-color: rgb(181, 214, 252); text-shadow: none; background-position: initial initial; background-repeat: initial initial; }
#write { max-width: 854px; margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: pre-wrap; text-align: justify; padding-bottom: 70px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export #write { margin: 0px auto; }
#write > p:first-child, #write > ul:first-child, #write > pre:first-child, #write > blockquote:first-child, #write > div:first-child { margin-top: 30px; }
img { max-width: 100%; }
input, button, select, textarea { color: inherit; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
::before, ::after, * { box-sizing: border-box; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write div, #write pre { width: inherit; }
h1 { font-size: 2rem; }
p, .mathjax-block { display: block; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: bold; font-style: italic; }
a { cursor: pointer; }
li span { min-width: 10px; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; margin: 4px 0px 0px; }
tr { page-break-inside: avoid; page-break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; page-break-inside: auto; }
table.md-table td { min-width: 80px; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror-code pre { padding: 0px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
.md-fences, pre.md-fences { font-size: 0.9rem; display: block; page-break-inside: avoid; text-align: left; overflow: visible; white-space: normal; position: relative !important; }
.md-fences.mock-cm { white-space: pre-wrap; }
.footnotes { color: rgb(136, 136, 136); font-size: 0.9rem; padding-top: 1em; padding-bottom: 1em; }
.footnotes + .footnotes { margin-top: -1em; }
sub, sup { line-height: inherit; position: inherit; top: inherit; vertical-align: super; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background-color: transparent; text-decoration: none; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 1rem; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; line-height: normal; font-weight: normal; text-align: left; box-sizing: content-box; direction: ltr; background-position: initial initial; background-repeat: initial initial; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li p, li .mathjax-block { margin: 0.5rem 0px; }
li { margin: 0px; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; }
@media print { 
  html, body { height: 100%; }
  .typora-export * { -webkit-print-color-adjust: exact; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
#write pre.md-meta-block { font-size: 0.8rem; min-height: 2.86rem; white-space: pre; background-color: rgb(204, 204, 204); display: block; background-position: initial initial; background-repeat: initial initial; }
p > .md-image:only-child { display: inline-block; width: 100%; text-align: center; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.mathjax-block { white-space: pre; padding-bottom: 0.65rem; overflow: hidden; width: 100%; }
p + .mathjax-block { margin-top: -1.143rem; }
.mathjax-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: none; box-shadow: none; }
:focus { outline: none; box-shadow: rgb(79, 172, 249) 0px 0px 2px 3px, rgb(120, 174, 218) 0px 0px 2px inset; }
.task-list { list-style-type: none; }
.task-list-item { position: relative; padding-left: 1em; }
.task-list-item input { position: absolute; top: 0px; left: 0px; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-top-left-radius: 10px; border-top-right-radius: 10px; border-bottom-right-radius: 10px; border-bottom-left-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc::after, .md-toc-content::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: bold; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
.md-toc-h6 { margin-left: 12em; }
@media screen and (max-width: 48em) { 
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 8em; }
  .md-toc-h6 { margin-left: 9.5em; }
}
a.md-toc-inner { color: inherit; font-size: inherit; font-style: inherit; font-weight: inherit; text-decoration: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: '.'; }
.md-tag { opacity: 0.5; }
h1 .md-tag, h2 .md-tag, h3 .md-tag, h4 .md-tag, h5 .md-tag, h6 .md-tag { font-weight: initial; opacity: 0.35; }


@font-face { font-family: 'Open Sans'; font-style: normal; font-weight: normal; src: local(Open Sans Regular), url(file:///Users/dsaiztc/Library/Application%20Support/abnerworks.Typora/themes/github/400.woff) format(woff); }
@font-face { font-family: 'Open Sans'; font-style: italic; font-weight: normal; src: local(Open Sans Italic), url(file:///Users/dsaiztc/Library/Application%20Support/abnerworks.Typora/themes/github/400i.woff) format(woff); }
@font-face { font-family: 'Open Sans'; font-style: normal; font-weight: bold; src: local(Open Sans Bold), url(file:///Users/dsaiztc/Library/Application%20Support/abnerworks.Typora/themes/github/700.woff) format(woff); }
@font-face { font-family: 'Open Sans'; font-style: italic; font-weight: bold; src: local(Open Sans Bold Italic), url(file:///Users/dsaiztc/Library/Application%20Support/abnerworks.Typora/themes/github/700i.woff) format(woff); }
html { font-size: 16px; }
body { font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; -webkit-font-smoothing: antialiased; }
#write { max-width: 800px; margin: 0px auto; padding: 20px 30px 40px; }
#write::after { height: 80px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
body > :first-child { margin-top: 0px !important; }
body > :last-child { margin-bottom: 0px !important; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; -webkit-font-smoothing: antialiased; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
hr { height: 4px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border-width: 0px 0px 1px; border-style: none none solid; overflow: hidden; box-sizing: content-box; border-bottom-color: rgb(221, 221, 221); }
body > h2:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child + h2 { margin-top: 0px; padding-top: 0px; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child { margin-top: 0px; padding-top: 0px; }
a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 { margin-top: 0px; padding-top: 0px; }
h1 p, h2 p, h3 p, h4 p, h5 p, h6 p { margin-top: 0px; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left-width: 4px; border-left-style: solid; border-left-color: rgb(221, 221, 221); padding: 0px 15px; color: rgb(119, 119, 119); }
table { padding: 0px; }
table tr { border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204); background-color: white; margin: 0px; padding: 0px; }
table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border: 1px solid rgb(204, 204, 204); text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(204, 204, 204); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
pre.md-fences, .md-fences, code, tt { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; font-family: Consolas, 'Liberation Mono', Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em; }
pre.md-fences, .md-fences { margin-bottom: 15px; margin-top: 15px; padding: 8px 1em 6px; }
.task-list { padding-left: 0px; }
.task-list-item { padding-left: 32px; }
.task-list-item input { top: 4px; left: 8px; }
@media screen and (min-width: 914px) { 
}
@media print { 
  table, pre { page-break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714286rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714286rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714286rem; }
.md-image > .md-meta { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; font-family: Consolas, 'Liberation Mono', Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em; color: inherit; }
.md-tag { color: inherit; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }


</style>
</head>
<body class='typora-export' >
<div  id='write'><h1 ><a name='header-c1' class='md-header-anchor'></a>OpenStreetMap Data Wrangling with MongoDB</h1><h2 ><a name='header-c6' class='md-header-anchor'></a>1. Introduction</h2><p>The goal of this project is to choose any area of the world in <a href='https://www.openstreetmap.org/'  >https://www.openstreetmap.org</a> and use data munging techniques, such as assessing the quality of the data for validity, accuracy, completeness, consistency and uniformity, to clean the <em>OpenStreetMap</em> data for a part of the world, converting it from XML to JSON format, importing the clean file into a <em>MongoDB</em> database and run some queries against it.</p><p>To obtain the data I have made a query to <code>http://overpass-api.de/query_form.html</code> after searching for <a href='https://www.openstreetmap.org/relation/4718122#map=10/42.9408/-3.4854'  ><em>Las Merindades</em></a>, which is the region where my hometown, <a href='https://en.wikipedia.org/wiki/Medina_de_Pomar'  ><em>Medina de Pomar</em></a>, belongs to. The query is the following:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>(node(42.5966, -4.2339, 43.2832, -2.7370);&lt;;);out meta;</pre><p>And the resulting <code>osm</code> (or <code>xml</code>) data is stored on <code>/data/file.osm</code>, which is a <em>355,3 MB</em> file (that can be downloaded also <a href='https://www.dropbox.com/s/9d8io7q19lkq2b1/merindades.osm?dl=0'  >here</a>). A <em>sample</em> of that file (created with the <a href='https://github.com/dsaiztc/OSMDataWrangling/blob/master/src/sample.py'  >sample.py</a> script) can be accessed <a href='https://github.com/dsaiztc/OSMDataWrangling/blob/master/data/sample.osm'  >here</a>.</p><h2 ><a name='header-c11' class='md-header-anchor'></a>2. Problems Encountered in the Map</h2><p>I assume that <strong>all the attributes, except for the <em>tags</em>, are correct</strong>. That is, the <em>common attributes</em>, the GPS positions for the <em>nodes</em> and the list of nodes for the <em>ways</em> were not sanity checked. Each <em>tag</em> has a <em>key/value pair</em> referring a specific characteristic of that <em>node</em> or <em>way</em>. I am going to audit first the <em>keys</em>, and then I will continue with the <em>values</em>.</p><h3 ><a name='header-c13' class='md-header-anchor'></a>2.1 Keys</h3><blockquote><p>This analysis has been performed with different functions within scripts: <a href='https://github.com/dsaiztc/OSMDataWrangling/blob/master/src/audit_keys_basic.py'  >audit_keys_basic.py</a>, <a href='https://github.com/dsaiztc/OSMDataWrangling/blob/master/src/audit_keys_namespaces.py'  >audit_keys_namespaces.py</a>.</p></blockquote><p>To audit the <em>keys</em> I have checked their structure applying <em>regular expressions</em>. By this way I have identified those <em>keys</em> that are different to others in some way: <em>keys</em> with <a href='http://wiki.openstreetmap.org/wiki/Namespace'  >namespaces</a> and <em>keys</em> with caps letters. I also looked for problematic characters (other than <code>a-z</code> or <code>_</code>).</p><ul><li><p>Problematic characters: 1 encountered.</p><ul><li><code>&lt;tag k=&quot;Torreón del castillo de los Salazar&quot; v=&quot;water&quot; /&gt;</code> should be <code>&lt;tag k=&quot;name&quot; v=&quot;Torreón del castillo de los Salazar&quot; /&gt;</code></li></ul></li><li><p>Caps chars: several matches but only one &quot;real&quot; error (view <a href='./README.md'  >full analysis</a> for further description): </p><ul><li><code>&lt;tag k=&quot;N&quot; v=&quot;Calle Real&quot; /&gt;</code> should be <code>&lt;tag k=&quot;name&quot; v=&quot;Calle Real&quot; /&gt;</code></li></ul></li><li><p>Namespaces: several cases where there are both namespaces and not namespaces for a specific <em>key</em>. For example, in <strong>population</strong> it is possible to have both <strong>key=population</strong> and <strong>key=population:date</strong>. The OSM standard allows this kind of naming, but if I want the attributes with namespaces nested within their <em>parent</em> (or <em>prefix</em>) then I have to create a <em>default</em> namespace for cases like this, having a <strong>key=population:default</strong> and a <strong>key=population:date</strong>. By this way the resulting JSON document will be:</p></li><li><pre class="md-fences"> <div class="CodeMirror cm-s-default CodeMirror-wrap"><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 22px;">&nbsp;</div></div><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;">{<span class="cm-meta">...</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-string">'population'</span>: {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-string">'default'</span>: <span class="cm-variable">population_value</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-string">'date'</span>: <span class="cm-variable">population_date</span></span></pre><pre class=""><span style="padding-right: 0.1px;">}}</span></pre></div></div></div></div></div></div></div></pre></li></ul><h3 ><a name='header-c32' class='md-header-anchor'></a>2.2 Values</h3><blockquote><p>This analysis has been performed with different functions within the <a href='https://github.com/dsaiztc/OSMDataWrangling/blob/master/src/audit_values_basic.py'  >audit_values_basic.py</a> script.</p></blockquote><p>Given the large amount of different attributes, I have focused in those that could be checked in some way, like the <a href='http://wiki.openstreetmap.org/wiki/Key:addr'  >address</a> fields.</p><p>Attending the <strong>housenumber</strong> values, there are different patterns: with only numbers, with numbers and a capital letter, with a number and a word <em>bis</em> (which means that there are two buildings with the same number; it appears close to the number, separated by a space, with capital and non capital letters), with a range of numbers (as a list and also as an interval) and others:</p><pre class="md-fences"> <div class="CodeMirror cm-s-default CodeMirror-wrap"><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 18.5px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">[<span class="cm-string">'SN(B)'</span>, <span class="cm-string">'SN(D)'</span>, <span class="cm-string">'7 - 43'</span>, <span class="cm-string">'2 - 36'</span>, <span class="cm-string">'46, BIS'</span>, <span class="cm-string">'2, 4 y 7'</span>, <span class="cm-variable">u</span><span class="cm-string">'8, 1\xba D'</span>, <span class="cm-string">'2, 4'</span>, <span class="cm-string">'6, 8'</span>, <span class="cm-string">'12, 14'</span>, <span class="cm-string">'13-15'</span>, <span class="cm-string">'SN(A)'</span>, <span class="cm-string">'15-17'</span>, <span class="cm-string">'2019.'</span>, <span class="cm-string">'1-3'</span>, <span class="cm-string">'SN(C)'</span>, <span class="cm-string">'SN(E)'</span>, <span class="cm-string">'4, 6'</span>, <span class="cm-string">'km 508'</span>, <span class="cm-string">'4, 6, 8, 10'</span>, <span class="cm-string">'s/n'</span>, <span class="cm-string">'3, 5, 7, 9'</span>, <span class="cm-string">'12-14'</span>, <span class="cm-string">'8, 10'</span>, <span class="cm-string">'37-39'</span>, <span class="cm-string">'12-38'</span>]</span></pre></div></div></div></div></div></div></div></pre><p>For those that have several values the best approach would be to save the values within an array, but I do not know if a range <code>12-14</code> includes the number 13 or not (probably not, at least in Spain). I have also values with <code>s/n</code> which means <em>sin número</em> (<em>without number</em> in spanish). I suppose the <code>SN(...)</code> values refer the same as <code>s/n</code> but with a letter instead of a number. However, I had some values that could be corrected (like <code>46, BIS</code> to <code>46 BIS</code> or <code>8, 1º D</code> to <code>8</code>).</p><p>Analyzing the <strong>housename</strong>, I saw one numeric value <code>1</code> that should not be there and three street names that probably should not be there either. In the case of <strong>city</strong>, we had one case that starts with lowercase and should be corrected.</p><p>I centered my efforts analyzing the <strong>street</strong> value, looking mainly for unexpected street types or abbreviations and creating a <em>mapping</em> function to correct those values. There were not so many abbreviations, most of the time I had to change the street type from <em>all-capital-letter</em> to a <em>sentence-like</em> form. I also fixed some abbreviations like <code>C/</code> and <code>CL</code> for <code>Calle</code>, <code>Bº</code> for <code>Barrio</code> or <code>CR</code> and <code>CRTA.</code> for <code>Carretera</code>. </p><p>By this analysis I detected a lot of cases where the values were not where they should be (like the <strong>housenumber</strong> inside the <strong>housename</strong>). I also had other cases where the use of the field was misunderstood, like the case we had a <strong>housenumber</strong> of <code>8, 1º D</code>, where <code>8</code> is indeed the number of the house but the other data should be placed into the <strong>floor</strong> and <strong>door</strong> fields. Furthermore, I had only detected theses cases because I was looking for wrong <em>street-type</em> names, but I am sure that there are plenty of them along the document (and a more in-depth analysis should be done to reach them).</p><h2 ><a name='header-c42' class='md-header-anchor'></a>3. Data Overview</h2><h3 ><a name='header-c43' class='md-header-anchor'></a>3.1 Documents</h3><p>As we have seen before, we have the original OSM xml document and a cleaned version in JSON format. These documents have the following approximate size:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>data.osm .......... 355 MB
cleaned.jsonl ..... 430 MB</pre><h3 ><a name='header-c46' class='md-header-anchor'></a>3.2 Database</h3><h4 ><a name='header-c47' class='md-header-anchor'></a>3.2.1 General Overview</h4><p>Now that I have collected the data within a MongoDB database is time to run some queries to extract some insights about the OSM data. We are going to use the <a href='http://docs.mongodb.org/v2.2/mongo/'  ><em>mongo</em> shell</a>, an interactive JavaScript shell.</p><ul><li>Total number of <em>Elements</em>:</li></ul><pre class="md-fences"> <div class="CodeMirror cm-s-default CodeMirror-wrap"><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 19px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">&gt; <span class="cm-variable">db</span>.<span class="cm-property">merindades</span>.<span class="cm-property">find</span>().<span class="cm-property">count</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">1855383</span></span></pre></div></div></div></div></div></div></div></pre><ul><li>Total number of <em>Nodes</em>:</li></ul><pre class="md-fences"> <div class="CodeMirror cm-s-default CodeMirror-wrap"><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 19px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">&gt; <span class="cm-variable">db</span>.<span class="cm-property">merindades</span>.<span class="cm-property">find</span>({<span class="cm-string cm-property">'type'</span>: <span class="cm-string">'node'</span>}).<span class="cm-property">count</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">1758132</span></span></pre></div></div></div></div></div></div></div></pre><ul><li>Total number of <em>Elements</em> that have a <em>null</em> value inside the <strong>visible</strong> attribute:</li></ul><pre class="md-fences"> <div class="CodeMirror cm-s-default CodeMirror-wrap"><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 19px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">&gt; <span class="cm-variable">db</span>.<span class="cm-property">merindades</span>.<span class="cm-property">aggregate</span>([{<span class="cm-string cm-property">'$group'</span>: {<span class="cm-string cm-property">'_id'</span>: <span class="cm-string">'$visible'</span>, <span class="cm-string cm-property">'count'</span>: {<span class="cm-string cm-property">'$sum'</span>: <span class="cm-number">1</span>}}}])</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-atom">null</span>, <span class="cm-string">"count"</span> : <span class="cm-number">1855383</span> }</span></pre></div></div></div></div></div></div></div></pre><p>In the <a href='https://github.com/dsaiztc/OSMDataWrangling/blob/master/src/clean.py'  >clean.py</a> script I created an attribute <em>visible</em> for those cases where it would not exist, associating a <em>null</em> value (instead of a <em>true</em> or <em>false</em>). As we can see here, there is not any <em>Element</em> that has a <em>visible</em> attribute in the original OSM file, so all the documents in the database have a <em>null</em> value within the <em>visible</em> attribute.</p><ul><li>Number of <strong>places</strong> aggregated by type:</li></ul><pre class="md-fences"> <div class="CodeMirror cm-s-default CodeMirror-wrap"><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 18.5px;">&nbsp;</div></div><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;">&gt; <span class="cm-variable">db</span>.<span class="cm-property">merindades</span>.<span class="cm-property">aggregate</span>([{<span class="cm-string cm-property">'$match'</span>: {<span class="cm-string cm-property">'place'</span>: {<span class="cm-string cm-property">'$exists'</span>: <span class="cm-number">1</span>}}}, {<span class="cm-string cm-property">'$group'</span>: {<span class="cm-string cm-property">'_id'</span>: <span class="cm-string">'$place'</span>, <span class="cm-string cm-property">'count'</span>: {<span class="cm-string cm-property">'$sum'</span>: <span class="cm-number">1</span>}}}, {<span class="cm-string cm-property">'$sort'</span>: {<span class="cm-string cm-property">'count'</span>: -<span class="cm-number">1</span>}}])</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"locality"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">12872</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"hamlet"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">1076</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"village"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">654</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"neighbourhood"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">206</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"isolated_dwelling"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">83</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"suburb"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">75</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"farm"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">8</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"town"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">8</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"yes"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">3</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"La Coteruca"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">1</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"state"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">1</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"city"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">1</span> }</span></pre></div></div></div></div></div></div></div></pre><p>Here there are some values that should probably not be there, like <strong>yes</strong> or <strong>La Coretuca</strong>. I should have audit these error in previous stages of the process or update the documents in the database.</p><ul><li>Number of unique users:</li></ul><pre class="md-fences"> <div class="CodeMirror cm-s-default CodeMirror-wrap"><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 19px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">&gt; <span class="cm-variable">db</span>.<span class="cm-property">merindades</span>.<span class="cm-property">distinct</span>(<span class="cm-string">'created.user'</span>).<span class="cm-property">length</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">553</span></span></pre></div></div></div></div></div></div></div></pre><ul><li>Top 5 users by contributions:</li></ul><pre class="md-fences"> <div class="CodeMirror cm-s-default CodeMirror-wrap"><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 18.5px;">&nbsp;</div></div><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;">&gt; <span class="cm-variable">db</span>.<span class="cm-property">merindades</span>.<span class="cm-property">aggregate</span>([{<span class="cm-string cm-property">'$group'</span>: {<span class="cm-string cm-property">'_id'</span>: <span class="cm-string">'$created.user'</span>, <span class="cm-string cm-property">'count'</span>: {<span class="cm-string cm-property">'$sum'</span>: <span class="cm-number">1</span>}}}, {<span class="cm-string cm-property">'$sort'</span>: {<span class="cm-string cm-property">'count'</span>: -<span class="cm-number">1</span>}}, {<span class="cm-string cm-property">'$limit'</span>: <span class="cm-number">5</span>}])</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"cronoser"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">415038</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"Emilio Gomez"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">280561</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"sanchi"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">170710</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"jonbergor"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">123627</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"www_dorono_tk"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">65890</span> }</span></pre></div></div></div></div></div></div></div></pre><p>As I was expecting here, the contributions are highly skewed, the contribution percentage of these 5 is: <em>cronoser</em> 22.37%, <em>Emilio Gomez</em> 15.12%, <em>sanchi</em> 9.2%, <em>jonbergor</em> 6.67% and <em>www_dorono_tk</em> 3.55%. Moreover, these 5 users, that represent the <strong>0.9% of the total users, have edited 56.91%</strong> of the <em>Elements</em>.</p><ul><li>Top 10 users by contribution:</li></ul><pre class="md-fences"> <div class="CodeMirror cm-s-default CodeMirror-wrap"><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 18.5px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">&gt; <span class="cm-variable">db</span>.<span class="cm-property">merindades</span>.<span class="cm-property">aggregate</span>([{<span class="cm-string cm-property">'$group'</span>: {<span class="cm-string cm-property">'_id'</span>: <span class="cm-string">'$created.user'</span>, <span class="cm-string cm-property">'count'</span>: {<span class="cm-string cm-property">'$sum'</span>: <span class="cm-number">1</span>}}}, {<span class="cm-string cm-property">'$sort'</span>: {<span class="cm-string cm-property">'count'</span>: -<span class="cm-number">1</span>}}, {<span class="cm-string cm-property">'$limit'</span>: <span class="cm-number">10</span>}, {<span class="cm-string cm-property">'$group'</span>: {<span class="cm-string cm-property">'_id'</span>: <span class="cm-string">'top_10_users'</span>, <span class="cm-string cm-property">'count'</span>: {<span class="cm-string cm-property">'$sum'</span>: <span class="cm-string">'$count'</span>}}}])</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"top_10_users"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">1304382</span> }</span></pre></div></div></div></div></div></div></div></pre><p>Here we can see that the top 10 users by contribution have edited the 70.3% of the <em>Elements</em> in our database. That is, <strong>1.8% of the total users have edited 70.3%</strong> of the <em>Elements</em>.</p><ul><li>Percentage of the <em>Elements</em> mapped by the top 5% users by contribution:</li></ul><pre class="md-fences"> <div class="CodeMirror cm-s-default CodeMirror-wrap"><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 18.5px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">&gt; <span class="cm-variable">db</span>.<span class="cm-property">merindades</span>.<span class="cm-property">aggregate</span>([{<span class="cm-string cm-property">'$group'</span>: {<span class="cm-string cm-property">'_id'</span>: <span class="cm-string">'$created.user'</span>, <span class="cm-string cm-property">'count'</span>: {<span class="cm-string cm-property">'$sum'</span>: <span class="cm-number">1</span>}}}, {<span class="cm-string cm-property">'$sort'</span>: {<span class="cm-string cm-property">'count'</span>: -<span class="cm-number">1</span>}}, {<span class="cm-string cm-property">'$limit'</span>: <span class="cm-number">27</span>}, {<span class="cm-string cm-property">'$group'</span>: {<span class="cm-string cm-property">'_id'</span>: <span class="cm-string">'top_10_users'</span>, <span class="cm-string cm-property">'count'</span>: {<span class="cm-string cm-property">'$sum'</span>: <span class="cm-string">'$count'</span>}}}])</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"top_10_users"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">1660270</span> }</span></pre></div></div></div></div></div></div></div></pre><p>The <strong>89.48% of the <em>Elements</em> have been mapped by the 5% of the users</strong>.</p><ul><li>Top 10 types of <strong>amenities</strong>:</li></ul><pre class="md-fences"> <div class="CodeMirror cm-s-default CodeMirror-wrap"><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 18.5px;">&nbsp;</div></div><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;">&gt; <span class="cm-variable">db</span>.<span class="cm-property">merindades</span>.<span class="cm-property">aggregate</span>([{<span class="cm-string cm-property">'$match'</span>: {<span class="cm-string cm-property">'amenity'</span>: {<span class="cm-string cm-property">'$exists'</span>: <span class="cm-number">1</span>}}}, {<span class="cm-string cm-property">'$group'</span>: {<span class="cm-string cm-property">'_id'</span>: <span class="cm-string">'$amenity'</span>, <span class="cm-string cm-property">'count'</span>: {<span class="cm-string cm-property">'$sum'</span>: <span class="cm-number">1</span>}}}, {<span class="cm-string cm-property">'$sort'</span>: {<span class="cm-string cm-property">'count'</span>: -<span class="cm-number">1</span>}}, {<span class="cm-string cm-property">'$limit'</span>: <span class="cm-number">10</span>}])</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"place_of_worship"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">1052</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"drinking_water"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">868</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"parking"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">526</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"bar"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">336</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"restaurant"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">273</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"bank"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">210</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"school"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">209</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"cafe"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">140</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"pharmacy"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">124</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"fuel"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">122</span> }</span></pre></div></div></div></div></div></div></div></pre><p>No surprise here, due to the fact that there is a church in almost every single village in Spain, no matter the size of it.</p><ul><li>Grouping the <em>places of worship</em> by <strong>religion</strong>:</li></ul><pre class="md-fences"> <div class="CodeMirror cm-s-default CodeMirror-wrap"><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 18.5px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">&gt; <span class="cm-variable">db</span>.<span class="cm-property">merindades</span>.<span class="cm-property">aggregate</span>([{<span class="cm-string cm-property">'$match'</span>: {<span class="cm-string cm-property">'amenity'</span>: {<span class="cm-string cm-property">'$exists'</span>: <span class="cm-number">1</span>}, <span class="cm-string cm-property">'amenity'</span>: <span class="cm-string">'place_of_worship'</span>}}, {<span class="cm-string cm-property">'$group'</span>: {<span class="cm-string cm-property">'_id'</span>: <span class="cm-string">'$religion'</span>, <span class="cm-string cm-property">'count'</span>: {<span class="cm-string cm-property">'$sum'</span>: <span class="cm-number">1</span>}}}, {<span class="cm-string cm-property">'$sort'</span>: {<span class="cm-string cm-property">'count'</span>: -<span class="cm-number">1</span>}}, {<span class="cm-string cm-property">'$limit'</span>: <span class="cm-number">5</span>}])</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"christian"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">1035</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-atom">null</span>, <span class="cm-string">"count"</span> : <span class="cm-number">16</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;">{ <span class="cm-string">"_id"</span> : <span class="cm-string">"muslim"</span>, <span class="cm-string">"count"</span> : <span class="cm-number">1</span> }</span></pre></div></div></div></div></div></div></div></pre><p>Also it would be likely that those that have no <strong>religion</strong> attribute (that appear as <em>null</em>) are also referring to <em>christian</em> religion.</p><h4 ><a name='header-c96' class='md-header-anchor'></a>6.2.2 Geospational Queries</h4><p>I have added a position attribute to the <em>Nodes</em> that allows to query in terms of distance to a desired point, I only need to create a <a href='http://docs.mongodb.org/manual/applications/geospatial-indexes/'  >geospatial index</a> first. Here I can use the <a href='http://docs.mongodb.org/manual/reference/operator/query/near/'  >$near</a> operator, that returns the documents from nearest to farthest. Because I am specifying a <a href='http://docs.mongodb.org/manual/core/2d/'  >2d index</a> with the <em>longitude</em> and <em>latitude</em> in the <strong>pos</strong> attribute in degrees, I need to specify the distance in the same units. Then, if I want to query within a distance in kilometers, I have to convert it by the following equation:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>distance [º] = (distance [km] / earth_radius [km] ) * ( 180 º / π rad ) </pre><p>with and earth radius of 6378.1 km</p><p>Here I am going to take the location reference of my hometown, <em>Medina de Pomar</em>, which is <code>[ -3.4861165, 42.9322093 ]</code>.</p><ul><li>Number of <em>Elements</em> within a distance of <strong>5 km</strong>:</li></ul><pre class="md-fences"> <div class="CodeMirror cm-s-default CodeMirror-wrap"><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 18.5px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">&gt; <span class="cm-variable">db</span>.<span class="cm-property">merindades</span>.<span class="cm-property">find</span>({<span class="cm-string cm-property">'pos'</span>: {<span class="cm-string cm-property">'$near'</span>: [ -<span class="cm-number">3.4861165</span>, <span class="cm-number">42.9322093</span> ], <span class="cm-string cm-property">'$maxDistance'</span>: (<span class="cm-number">5</span> * (<span class="cm-number">180</span>/(<span class="cm-variable">Math</span>.<span class="cm-property">PI</span> * <span class="cm-number">6378.1</span>)))}}).<span class="cm-property">count</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">50047</span></span></pre></div></div></div></div></div></div></div></pre><ul><li>Number of <em>Amenities</em> within a distance of <strong>5 km</strong>:</li></ul><pre class="md-fences"> <div class="CodeMirror cm-s-default CodeMirror-wrap"><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 18.5px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">&gt; <span class="cm-variable">db</span>.<span class="cm-property">merindades</span>.<span class="cm-property">find</span>({<span class="cm-string cm-property">'pos'</span>: {<span class="cm-string cm-property">'$near'</span>: [ -<span class="cm-number">3.4861165</span>, <span class="cm-number">42.9322093</span> ], <span class="cm-string cm-property">'$maxDistance'</span>: (<span class="cm-number">5</span> * (<span class="cm-number">180</span>/(<span class="cm-variable">Math</span>.<span class="cm-property">PI</span> * <span class="cm-number">6378.1</span>)))}, <span class="cm-string cm-property">'amenity'</span>: {<span class="cm-string cm-property">'$exists'</span>: <span class="cm-number">1</span>}}).<span class="cm-property">count</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">143</span></span></pre></div></div></div></div></div></div></div></pre><ul><li>Number of <em>bars</em>, <em>cafes</em> and <em>restaurants</em> within a distance of <strong>5 km</strong>.</li></ul><pre class="md-fences"> <div class="CodeMirror cm-s-default CodeMirror-wrap"><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 18.5px;">&nbsp;</div></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">&gt; <span class="cm-variable">db</span>.<span class="cm-property">merindades</span>.<span class="cm-property">find</span>({<span class="cm-string cm-property">'pos'</span>: {<span class="cm-string cm-property">'$near'</span>: [ -<span class="cm-number">3.4861165</span>, <span class="cm-number">42.9322093</span> ], <span class="cm-string cm-property">'$maxDistance'</span>: (<span class="cm-number">5</span> * (<span class="cm-number">180</span>/(<span class="cm-variable">Math</span>.<span class="cm-property">PI</span> * <span class="cm-number">6378.1</span>)))}, <span class="cm-string cm-property">'amenity'</span>: {<span class="cm-string cm-property">'$in'</span>: [<span class="cm-string">'bar'</span>, <span class="cm-string">'cafe'</span>, <span class="cm-string">'restaurant'</span>]}}).<span class="cm-property">count</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">53</span></span></pre></div></div></div></div></div></div></div></pre><p>I was always impressed by the amount of this kind of places in my hometown, considering that it has an approximate population of 6.000 habitants.</p><ul><li>Number of <em>schools</em>, <em>places of worship</em>, <em>pharmacies</em>, <em>banks</em> and <em>fuel stations</em> within a distance of <strong>5 km</strong>:</li></ul><pre class="md-fences"> <div class="CodeMirror cm-s-default CodeMirror-wrap"><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 18.5px;">&nbsp;</div></div><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;">&gt; <span class="cm-variable">db</span>.<span class="cm-property">merindades</span>.<span class="cm-property">find</span>({<span class="cm-string cm-property">'pos'</span>: {<span class="cm-string cm-property">'$near'</span>: [ -<span class="cm-number">3.4861165</span>, <span class="cm-number">42.9322093</span> ], <span class="cm-string cm-property">'$maxDistance'</span>: (<span class="cm-number">5</span> * (<span class="cm-number">180</span>/(<span class="cm-variable">Math</span>.<span class="cm-property">PI</span> * <span class="cm-number">6378.1</span>)))}, <span class="cm-string cm-property">'amenity'</span>: <span class="cm-string">'school'</span>}).<span class="cm-property">count</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">1</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&gt; <span class="cm-variable">db</span>.<span class="cm-property">merindades</span>.<span class="cm-property">find</span>({<span class="cm-string cm-property">'pos'</span>: {<span class="cm-string cm-property">'$near'</span>: [ -<span class="cm-number">3.4861165</span>, <span class="cm-number">42.9322093</span> ], <span class="cm-string cm-property">'$maxDistance'</span>: (<span class="cm-number">5</span> * (<span class="cm-number">180</span>/(<span class="cm-variable">Math</span>.<span class="cm-property">PI</span> * <span class="cm-number">6378.1</span>)))}, <span class="cm-string cm-property">'amenity'</span>: <span class="cm-string">'place_of_worship'</span>}).<span class="cm-property">count</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">1</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&gt; <span class="cm-variable">db</span>.<span class="cm-property">merindades</span>.<span class="cm-property">find</span>({<span class="cm-string cm-property">'pos'</span>: {<span class="cm-string cm-property">'$near'</span>: [ -<span class="cm-number">3.4861165</span>, <span class="cm-number">42.9322093</span> ], <span class="cm-string cm-property">'$maxDistance'</span>: (<span class="cm-number">5</span> * (<span class="cm-number">180</span>/(<span class="cm-variable">Math</span>.<span class="cm-property">PI</span> * <span class="cm-number">6378.1</span>)))}, <span class="cm-string cm-property">'amenity'</span>: <span class="cm-string">'bank'</span>}).<span class="cm-property">count</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">6</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&gt; <span class="cm-variable">db</span>.<span class="cm-property">merindades</span>.<span class="cm-property">find</span>({<span class="cm-string cm-property">'pos'</span>: {<span class="cm-string cm-property">'$near'</span>: [ -<span class="cm-number">3.4861165</span>, <span class="cm-number">42.9322093</span> ], <span class="cm-string cm-property">'$maxDistance'</span>: (<span class="cm-number">5</span> * (<span class="cm-number">180</span>/(<span class="cm-variable">Math</span>.<span class="cm-property">PI</span> * <span class="cm-number">6378.1</span>)))}, <span class="cm-string cm-property">'amenity'</span>: <span class="cm-string">'pharmacy'</span>}).<span class="cm-property">count</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">4</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&gt; <span class="cm-variable">db</span>.<span class="cm-property">merindades</span>.<span class="cm-property">find</span>({<span class="cm-string cm-property">'pos'</span>: {<span class="cm-string cm-property">'$near'</span>: [ -<span class="cm-number">3.4861165</span>, <span class="cm-number">42.9322093</span> ], <span class="cm-string cm-property">'$maxDistance'</span>: (<span class="cm-number">5</span> * (<span class="cm-number">180</span>/(<span class="cm-variable">Math</span>.<span class="cm-property">PI</span> * <span class="cm-number">6378.1</span>)))}, <span class="cm-string cm-property">'amenity'</span>: <span class="cm-string">'fuel'</span>}).<span class="cm-property">count</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">2</span></span></pre></div></div></div></div></div></div></div></pre><ul><li>Number of <em>places of worships</em> and <em>bars, cafes and restaurants</em> within a distance of <strong>25 km</strong>:</li></ul><pre class="md-fences"> <div class="CodeMirror cm-s-default CodeMirror-wrap"><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 18.5px;">&nbsp;</div></div><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;">&gt; <span class="cm-variable">db</span>.<span class="cm-property">merindades</span>.<span class="cm-property">find</span>({<span class="cm-string cm-property">'pos'</span>: {<span class="cm-string cm-property">'$near'</span>: [ -<span class="cm-number">3.4861165</span>, <span class="cm-number">42.9322093</span> ], <span class="cm-string cm-property">'$minDistance'</span>: <span class="cm-number">0</span>, <span class="cm-string cm-property">'$maxDistance'</span>: (<span class="cm-number">25</span> * (<span class="cm-number">180</span>/(<span class="cm-variable">Math</span>.<span class="cm-property">PI</span> * <span class="cm-number">6578.1</span>)))}, <span class="cm-string cm-property">'amenity'</span>: <span class="cm-string">'place_of_worship'</span>}).<span class="cm-property">count</span>()  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">21</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&gt; <span class="cm-variable">db</span>.<span class="cm-property">merindades</span>.<span class="cm-property">find</span>({<span class="cm-string cm-property">'pos'</span>: {<span class="cm-string cm-property">'$near'</span>: [ -<span class="cm-number">3.4861165</span>, <span class="cm-number">42.9322093</span> ], <span class="cm-string cm-property">'$minDistance'</span>: <span class="cm-number">0</span>, <span class="cm-string cm-property">'$maxDistance'</span>: (<span class="cm-number">25</span> * (<span class="cm-number">180</span>/(<span class="cm-variable">Math</span>.<span class="cm-property">PI</span> * <span class="cm-number">6578.1</span>)))}, <span class="cm-string cm-property">'amenity'</span>: {<span class="cm-string cm-property">'$in'</span>: [<span class="cm-string">'bar'</span>, <span class="cm-string">'cafe'</span>, <span class="cm-string">'restaurant'</span>]}}).<span class="cm-property">count</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">155</span></span></pre></div></div></div></div></div></div></div></pre><p>Increasing the distance from the center of the town, I can reach other small villages where each one of them would probably have its own church and probably several <em>bars</em> (at least in the bigger ones).</p><h2 ><a name='header-c123' class='md-header-anchor'></a>4. Additional Ideas</h2><p>Given the results of the analysis, I think the most problematic errors are due to the fact the the attributes are too much free. Here I am not only referring to the fact that <em>both the key and value are free format text fields</em> (as the <a href='http://wiki.openstreetmap.org/wiki/Tags'  >OSM wiki</a> specifies), but also to the freedom that a common user has when adding or modifying a value. </p><p>In my opinion it could be a good idea to add some kind of <em>field verification</em> within the different <em>most-used</em> <em>tags</em>. I know it could be complex to put in practice because of the different conventions for different countries, but this <em>freedom</em> is a continuous source of errors. </p><p>For example there could be a <em>verification</em> process while the user is introducing a new <strong>street</strong>, so that he would not be allowed to enter a full address. Instead of allowing that behavior, the application could show the user an <em>error hint</em> similar to this:</p><p><img src='./images/error_hint.png' alt='Error hint' /></p><p>Another option could be to create a directory with <em>Elements</em> that are likely to be wrong, where users could access them directly (without analyzing the overall data) and correct them there. This directory could be created directly by the users, identifying errors manually. Once that database grows up, it could be a good idea to develop a <em>Machine Learning</em> system that learns from that data and create <em>patterns</em> to identify wrong <em>Elements</em> so that it will not be necessary to continue identifying those wrong values manually.</p><p>By this way there would be an automatic system that identifies possible wrong values and asks <em>expert</em> users to verify those values, creating a more reliable source of data.</p><h2 ><a name='header-c130' class='md-header-anchor'></a>5. Conclusion</h2><p>Through all the stages of this project I have seen that there are a wide variety or errors within the OSM data. I have centered the effort in analyzing only some of the fields, but <strong>there is definitely more work to do if we want a completely cleaned data</strong>. I have found errors in both <em>keys</em> and <em>values</em> of the different <em>tags</em>, and I have not only corrected them but also fixed some issues with the data, like creating various fields from one originally wrong (in case of <em>streets</em> that included also the number of the house and even the door letter). </p><p>Despite the effort, the huge amount of different kind of <em>tags</em> make the cleaning process almost impossible if the efforts are not centered in the fields that the interest in analyzing yields (like in this case the <em>address</em>). </p><p>The OSM edition process is too much open to interpretations and in some cases it is not clear what rule to apply while tagging an item. It seems that it is too complex to know all the procedures to apply or they are too complex for an average user to spent time reading the documentation before start editing (what leads in errors about <em>what-each-tag-means</em>).</p><p>I also find particularly tricky to work with the absolutely freedom allowed while adding new tags. I think that a more-structured approach could benefit the overall experience while working with OSM data.</p><p>Apart from that, I think is incredible the power that a community could have while creating things together. Open Street Maps is without any doubt a great source of information and also it is probably the most recently actualized data (which depends on the activity of their users of course). </p></div>
</body>
</html>